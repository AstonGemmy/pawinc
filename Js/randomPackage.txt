$(document).ready(function() {
	
	// Slide show scripts
	var slideIndex = 0;
	var current_slide = 0;
	var delay_timer = 3000;	
	showSlides(slideIndex);
	newSlide(current_slide);
	
	
	$('.slideDot').click(function(){
		$thisSlide = $(this);
		slideIndex = $thisSlide.index();
		clearTimeout(autoSlide);
		showSlides(slideIndex);
	});
	
	$('#slideLeft, #slideRight').click(function(){		
		$selectedDirection = $(this);
		var slides = document.getElementsByClassName("mySlides");
		if ($selectedDirection.attr('id') == 'slideRight') {			
			slideIndex = slideIndex + 1;
			if (slideIndex > slides.length) {slideIndex = 1} //if slideIndex is greater than the number of images in the slide, it should return to 1(the first image)
		} else if ($selectedDirection.attr('id') == 'slideLeft') {
			slideIndex = slideIndex - 1;		
			if (slideIndex < 1) {slideIndex = slides.length} //if slideIndex is a negative number, it should return to the last image)
		}
		clearTimeout(autoSlide);
		showSlides(slideIndex);
	});
	
	function showSlides(slideIndex) {
		var j;
		var slides = document.getElementsByClassName("mySlides");
		var dots = document.getElementsByClassName("slideDot");
		
		for (j = 0; j < slides.length; j++) {
		   slides[j].style.display = "none";
		   dots[j].className = dots[j].className.replace(" activeDot", "");
		}
		
		slideIndex++;
		
		if (slideIndex > slides.length) {slideIndex = 1} //if slideIndex is greater than the number of images in the slide, it should return to 1(the first image)
		if (slideIndex < 1) {slideIndex = slides.length} //if slideIndex is a negative number, it should return to the last image)    
		
		slides[slideIndex-1].style.display = "block";  
		dots[slideIndex-1].className += " activeDot";
		autoSlide = setTimeout(function() {
			showSlides(slideIndex);
		}, delay_timer); // Change image every 8 seconds
	}
	
	var $window = $(window);
	
	function fadeHeader() {
		
		var $opacityValue = (0 + $window.scrollTop() / 300);
		var $BS_opacityValue = ($opacityValue / 50);
		
		$('.header').css("background", "rgba(255,255,255," + $opacityValue + ")").css("box-shadow","0px 0px 5px rgba(0,0,0," + $BS_opacityValue + ")");

	}
	
	function check_if_in_view() {
		
		var header = document.getElementById("header");
		var brand_name = document.getElementById("brand-name");
	
		// When the user scrolls down 80px from the top of the document, resize the navbar's padding and the logo's font size
		if (document.body.scrollTop > 80 || document.documentElement.scrollTop > 80) {

			header.classList.add("header-on-scroll");
			brand_name.classList.add("brand-name-on-scroll");

		} else {

			header.classList.remove("header-on-scroll");
			brand_name.classList.remove("brand-name-on-scroll");

		}
		
	}
	
	$('#testimonies-left, #testimonies-right').click(function() {
		var scroll__Dir = $(this).attr('id');
		var item = document.querySelector('#testimonies-container');
		var item__width = item.clientWidth;
		if (scroll__Dir == 'testimonies-left') {
			document.querySelector('#testimonies-cover').scrollBy({left:(-item__width * 3), behavior:'smooth'});
		} else if (scroll__Dir == 'testimonies-right') {			
			document.querySelector('#testimonies-cover').scrollBy({left:(item__width * 3), behavior:'smooth'});
		}	
	});
	
	$('#excerpts-left, #excerpts-right').click(function() {
		var scroll__Dir = $(this).attr('id');
		var item = document.querySelector('#excerpts-slide');
		var item__width = item.clientWidth;
		if (scroll__Dir == 'excerpts-left') {
			document.querySelector('#excerpts-slide').scrollBy({left:(-item__width * 3), behavior:'smooth'});
		} else if (scroll__Dir == 'excerpts-right') {			
			document.querySelector('#excerpts-slide').scrollBy({left:(item__width * 3), behavior:'smooth'});
		}	
	});	
	
	document.getElementById("slide-cover").addEventListener("click", elem => {
		var current_slide_index;
		var slide_length = document.getElementsByClassName("slides").length;		
		var slide_items = document.getElementById("slide-item-cover");
		var slide_items_length = slide_items.children.length;
		
		for (var i = 0; i < slide_items_length; i++) {
			(function(index) {
				if (slide_items.children[i].className.includes("active")) {
					current_slide_index = index;
				}
			})(i);
		}
		
		if (elem.target.id.includes("right") || elem.target.parentNode.id.includes("right")) {
			current_slide = (current_slide_index + 1);
			if (current_slide > (slide_length - 1)) {current_slide = 0;}
			clearTimeout(slide_timer);
			newSlide(current_slide);
		} else if (elem.target.id.includes("left") || elem.target.parentNode.id.includes("left")) {
			current_slide = (current_slide_index - 1);
			if (current_slide < 0) {current_slide = (slide_length - 1);}
			clearTimeout(slide_timer);
			newSlide(current_slide);
		}	
		
	});
	
	function newSlide(current_slide) {
		
		var slide__container = document.querySelector('#slideshow-container');
		var slide_item = slide__container.querySelectorAll('.slides');
		
		var slide_indicator = document.querySelectorAll(".slide-item-selector");
		
		for (var j = 0; j < slide_indicator.length; j++) {
		   slide_indicator[j].className = slide_indicator[j].className.replace(" slide-item-selector-active", "");
		}
		
		current_slide = Math.abs(current_slide);
		current_slide++;
		
		slide_position = slide_item[current_slide - 1].offsetLeft;
		slide__container.scrollTo({
			left:slide_position
		});
		
		slide_indicator[current_slide - 1].className += " slide-item-selector-active";	
		
		if (current_slide > (slide_item.length - 1)) {current_slide = 0;}
		
		slide_timer = setTimeout(function() {
			newSlide(current_slide);
		}, 5000);
		
	}
	
	
	let observer = new IntersectionObserver((entries, observer) => {
		
		entries.forEach(entry => {
			
			if (entry.isIntersecting) {
				entry.target.querySelector('.slide-text .slide-title-positioning .slide-font-title').classList.add("is-visible");
				entry.target.querySelector('.slide-text .slide-title-positioning .slide-font-subtitle').classList.add("is-visible");
			} else {
				entry.target.querySelector('.slide-text .slide-title-positioning .slide-font-title').classList.remove("is-visible");
				entry.target.querySelector('.slide-text .slide-title-positioning .slide-font-subtitle').classList.remove("is-visible");
			}
			
		});
		
	}, {root:document.querySelector('#slideshow-container'), rootMargin:"0px 0px 0px 0px", threshold:0.75});
	
	document.querySelectorAll('#slideshow-container .slides').forEach(img => {
		observer.observe(img)
	});
	
	$window.on('scroll', function() {
		
		check_if_in_view();		
		fadeHeader();
		
	});
	
	//fetch('/users.json').then((response) => {response.json()}).then((data) => {alert(data)}).catch((err) => {console.log(err)});
	
});